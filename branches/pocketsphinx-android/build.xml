<?xml version="1.0" encoding="UTF-8"?>

<project default="jar">

  <property file="build.properties"/>

  <target name="clean">
    <delete dir="build"/>
    <delete dir="libs"/>
    <delete dir="obj"/>
  </target>

  <target name="compile">
    <mkdir dir="build/classes"/>
    <javac target="1.6"
      srcdir="src"
      destdir="build/classes"
      includeAntRuntime="false"/>
  </target>

  <target name="swig">

    <mkdir dir="src/edu/cmu/pocketsphinx"/>

    <exec executable="swig">
      <arg line="-I../sphinxbase/include -I../sphinxbase/swig"/>
      <arg line="-java -package edu.cmu.pocketsphinx"/>
      <arg line="-outdir src/edu/cmu/pocketsphinx/ -o jni/sphinxbase_wrap.c"/>
      <arg line="../sphinxbase/swig/sphinxbase.i"/>
    </exec>

    <exec executable="swig">
      <arg line="-I../sphinxbase/swig"/>
      <arg line="-I../pocketsphinx/include -I../pocketsphinx/swig"/>
      <arg line="-java -package edu.cmu.pocketsphinx"/>
      <arg line="-outdir src/edu/cmu/pocketsphinx/ -o jni/pocketsphinx_wrap.c"/>
      <arg line="../pocketsphinx/swig/pocketsphinx.i"/>
    </exec>

    <exec executable="${ndk.dir}/ndk-build"/>
  </target>

  <target name="jar" depends="compile,swig">
    <jar destfile="build/pocketsphinx-android.jar" basedir="build/classes">
      <fileset dir="libs"/>
    </jar>
  </target>
</project>
